<!DOCTYPE html>
<html>
<head>
	<style>
		a.point{
			position: absolute;  
			top: 170px;  
			left: 260px;
			width: 10px;
			height: 10px;
			border-radius: 50%;
			background: skyblue;
		}

		.my-contextmenu {
			display: none;
			position: fixed;
			height: 70px;
			width: 400px;
			background-color: #fff;
			border: 1px solid #ccc;
			box-shadow: 1px 1px 1px rgba(0,0,0,.2);
			z-index: 1000;
			}
		.my-contextmenu.show {
			display: block;
			}
		.my-contextmenu ul {
			list-style: none;
			}
		.my-contextmenu ul li {
			padding: 4px 4px;
			font-size: 14px;
			color: #333;
			}
	</style>
	<script>
			globalx=0
	</script>
</head>
<body onContextmenu="return false;">
	<img src="./floor_map/sample.svg" id="target">
	<br>
	<!-- context menu --> 
	<div class="my-contextmenu" id="js-contextmenu">
		<ul>
			<li>add picture here<input type="file" id="setfile"></li>
		</ul>
	</div>
	<script>
		var myContextMenu = document.getElementById('js-contextmenu');
		document.getElementById("target").addEventListener('contextmenu',function(e){
			var imgRect = this.getBoundingClientRect() ;
			var x = e.pageX + imgRect.left;
			var y = e.pageY + imgRect.top;
			myContextMenu.style.left = x+'px';
			myContextMenu.style.top = y+'px';
			myContextMenu.classList.add('show');
			console.log(x,y);   // x座標(絶対座標)
			globalx=x
			globaly=y
		});
		document.body.addEventListener('click',function(){
			if(myContextMenu.classList.contains('show')) {
				myContextMenu.classList.remove('show');
			}
		});
	</script>
	<script>
		var setfile = document.getElementById("setfile");
		setfile.addEventListener("change", function(evt){
		var file = evt.target.files;
		alert(file[0].name + "を取得しました。");
		//JSON preserve
		var tasks = [
		{ posx: globalx, posy: globaly, tags: ['project1', 'memo'] },
		{ task: 'task2', isDone: false, tags: ['project1', 'memo'] },
		{ task: 'task3', isDone: false, tags: ['project2', 'asap'] }
		];
		var data = JSON.stringify(tasks);
		var exp = document.createElement('a');
		exp.textContent = 'export'
		exp.download = 'tasks.json';
		exp.href = window.URL.createObjectURL(new Blob([data], { type: 'text/plain' }));
		exp.dataset.downloadurl = ['text/plain', exp.download, exp.href].join(':');
		var exportLink = document.getElementById('export-link');
		exportLink.appendChild(exp);

		},false);
		</script>
	<span id="export-link"></span>
</body>
</html>